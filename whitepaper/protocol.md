# Sweet Gossip - P2P protocol for Gig economy

Sweet Gossip protocol is a P2P, mobile first, Proof of Work protected, gossip protocol built on top of the Lightning Network that enables message broadcast (job proposal) and reply (job offer). It uses game-theoretic approach to preserve its properties that are aligned with the Bitcoin ecosystem.

#### Version history
|date|version|author|comment|
|----|-------|------|-------|
|Thu 10 Nov 2022|1.0|Pawel Kaplanski <<pawel@donttrustverify.org>>|initial version|

## Motivation
GIG economy refers to the work done by casual workers coordinated by a software system. At the time of writing this paper, the end-customer of the GIG worker directly interacts with the centralized, cloud based platform and also pays for the services using the platform, which, after the job is done, is sharing the revenue with the assigned GIG worker. The actual job in this setting is done by the GIG Worker for the customer, making the online platform a tool that supports and manages the effectiveness of the job. The main goal of a centralized online platform is to maximize the total revenue generated by the system and the underlying company that operates it. This optimization problem is solved using AI tools and techniques, like gamification and for-purpose misinformation. It is still possible because GIG workers and customers have to trust the platform for its efficiency as the technology that implements it is opaque and manageable by its implementers. 

This kind of cybernetic system uses the human power of GIG workers managed by AI, to extract value for the company shareholders. The AI uses the behavioral data represented as interactions with the platform. In the long run this system is not sustainable as it is not aligned with human nature and needs. [MORE! need more explanation - podcast]

We are proposing the protocol designed for GIG economy, that by eliminating need of central online platforms will create a new paradigm where the GIG worker will be engaged directly by the end customer and be self managed by the open protocol allowing GIG workers to accomplish their tasks and earn money on a free market without the need for existence of trusted third party. 

Lack of central organization also means that minimal volume of data is shared between GIG workers and end-customers, just enough to fulfill the job according to the protocol-driven off-chain smart-contract that uses P2P money like Lightning Network on Bitcoin, therefore forming layer 3 protocol from the Bitcoin perspective.

## Sweet Gossip P2P Network

Sweet Gossip P2P Network is a globally symmetric P2P network, meaning that there is no direct need to run any operation critical services in the cloud. Nodes can run as apps for modern mobile devices. The need for implementation of supporting services that are cloud or edge computing based helps make the service more user friendly, but is never critical for the system operation itself. Sweet Gossip node is a software module that is run by every device that uses Sweet Gossip protocol and forms a basis of communication. 

Its important to explicitly say that we are not inventing any new coin or token, but rather we are speaking how Sweet Gossip Protocol can be built as a layer 3 protocol on top of the Lightning Network (being itself a layer 2 network sitting on top of Bitcoin network), therefore if any, the Bitcoin is a native token of the Sweet Gossip Network.

Sweet Gossip P2P Network preserves:
- P2P Symmetry - every node does the same thing
- Permissionlessness - anyone with internet access can join Sweet Gossip P2P network
- Mobile first - the cost of running Sweet Gossip node is marginal on modern mobile devices
- Privacy - the communication is encrypted
- Anonymity - any information about the people behind the nodes is hidden
- DDos and Spam protection - it uses Proof of Work (PoW) and/or micropayments to protect the network from DDos and Spam 
- Sustainability - the protocol is designed so all its participants benefit of joining the network
- Implicit punishment - the protocol do not explicitly punish unhonest participants, but rather makes honest participant benefit more than unhonest ones

Sweet Gossip Protocol is a gossip protocol, that allows a network broadcast in a similar way like gossip spreads. Assuming that each sweet gossip node is connected to its peers and that the network graph is connected, each node works independently and on the event of receiving a message that needs to be broadcasted. It selects several peers and sends the message, in its owner interest, to peers making the message to spread over the network like a gossip (Fig 1.). It's inevitable that there occur a situation that, if some node will not send the message to all of its peers, some nodes will not receive a broadcasted message even if a network graph is connected (e.g. node C on the Fig 1.), but from the game theoretic perspective it will not be a beneficial situation, so this is up to the network operators to make the flow as efficient as possible.

Sweet Gossip is a protocol, meaning that it only specifies the minimal set of rules to make it beneficial for all the nodes. It doesn't say explicitly how the network node should be implemented. The node implementation is free to do whatever is the best to make it beneficial for the node owner.

![Network](./network.svg)
Fig 1. The intuition behind gossip protocol

# The protocol

Sweet Gossip has single purpose: to broadcast the job proposal to the interesting parties and collect job offers from interested contractors. 

For sake of clarity we use the following nameing convention:
1. Peer - any gossip network node
1. Originator - Peer that is the origin of the broadcasted message. From the Gig economy point of view it is a customer.
2. Middleman - Peer that is passing the broadcast further as well as bringing back the reply
3. Replier - Peer that is replynig to the broadcast.
To target the job proposal it uses topics. Topics are filesystem like paths and all of the topics form a topic tree.

Lets describe how the broadcast works from the message passing perspective. Here we assume that nodes of the gossip network are already connected to their peers via some internet transport protocol (e.g. TCP, UDP with or without hole punching, mobile mesh e.t.c) and the other peer is also accepting sweet gossip protocol. How the nodes discover its peers is not a part of the protocol.

As the Originator (e.g. Node A) wants to broadcast the message (job proposal) first step is to ask its selected peer (e.g. Node B) how can the message be broadcasted.

The sequence diagram is show below:

```mermaid
sequenceDiagram
    Originator->>Peer: Ask For Favour frame
    activate Peer
    Peer-->>Originator: Ask For Favour Reply frame
    deactivate Peer
    Originator->>Peer: Broadcast
```

This is done by sending the following frame:

### Ask For Favour
|field|value
|----|---|
|topic|string|

The topic is a filesystem like path that is specifying the topic that has a hierarchical structure. 

If the customer is looking for a ride in Sydney, the topic that can be used has a form /Drive/Australia/Sydney and it is a hint for the Sweet Gossip network nodes allowing them to target the broadcast specifically. The root topic / means that the message is about to be broadcasted on the entire network.

```mermaid
flowchart TD
/ --> Drive --> Australia & US & China & Poland
Australia --> Sydney & Melbourne & Brisbane
US --> NY & Boston
Poland --> Warsaw & Krakow & Gdansk
```

If the peer B is willing to cooperate, it sends back the PoW frame or Lightning Network (LN) frame:


Reply of the peer (if any) is a frame specifying the following fields:
### Ask For Favor Reply
|field|value
|----|---|
|favour|number:timestamp|
|pow scheme|string|
|pow complexity|number|

Where:
- favour is a unique number combined with the timestamp of now, 
- pow scheme specifies the PoW algorithm that the peer is willing to use (e.g. SHA256)
- pow complexity specifies the expected complexity of pow scheme

LN scheme allows the peer to ask for the Bitcoin reward and the frame here has the following scheme:

|field|value
|----|---|
|lightning network address|lnaddr|
|price|satoshis|

Where:
- lightning network address is the address where to pay
- price is the number of satoshis

The node A can then accept the requirements of the peer B by sending the broadcast frame. Node B can either send back the job offer to the node A or broadcast the job proposal to its selected peers after asking them for favour in the same way. 

```mermaid
sequenceDiagram
    Middleman->>Its Peer #1: Ask For Favour & Broadcast
    Middleman->>Its Peer #2: Ask For Favour & Broadcast
    Middleman->>Its Peer #3: Ask For Favour & Broadcast
    Middleman->>...:Ask For Favour & Broadcast
```

### Broadcast
|field|value
|----|---|
|nounce or utxo|number or lntrans|
|favour|number:timestamp|
|message|string|
|originator "thank you secret" Public Key | public key|
|reply Public Key | public key|
|reply lightning network address|lnaddr|
|reply price|satoshis|

After the gossip is spread, the node that is happy to accept the broadcasted message instead of broadcasting it further is doing it with Reply Request Frame. The Replying node is doing it to the selected node that was the source of the broadcast frame.

Replying for the broadcast is an expensive activity. The expense is secured by the condition of having a confirmation from the initial node that the reply message was delivered back. Also the reply is encryped together with the original message so the originator can always verify the consistency of the message. The expense is calculated as a number of satoshis that is specified in the reply price.

The node needs to construct utxo on the LN channel that will cover the requested price on two conditions:
- timeout
- receiving the "thank you secret Private Key" from the originator of the broadcasting message

### Reply Request
|field|value
|----|---|
|encrypted [message/reply/inet-addr]|string|
|utxo|lntrans|

### Validation and Verification
The originator is decompressing the message using his PrivateKey and compares message with the original message. If message is the same the next step is to directly call the replying party and confirm that there was not message intrusion by sending the message directly to its inet-addr. If the response is OK then the originator is sure that the reply was not compromised by any of the broadasting nodes.

At the end of the, the originator should reply with the "thank you secret" back to its broadcasting peer.

```mermaid
sequenceDiagram
    Originator->>Middleman1: AskForFavour
    Middleman1->>Originator: AskForFavourReply
    Originator->>Middleman1: Broadcast
    Middleman1->>Middleman2 : AskForFavour & Broadcast
    Middleman2->>Replier : AskForFavour & Broadcast
    Replier->>Middleman2 : Reply
    Middleman2->>Middleman1 : Reply
    Middleman1->>Originator : Reply
    Originator->>Replier: Validate
    Replier->>Originator: Ack
    Replier->>Middleman2: ThankYou
    Middleman2->>Middleman1 : ThankYou
    Middleman1->>Originator : ThankYou
```

### Thank you
|field|value
|----|---|
|originator "thank you secret" Private Key|number|

### Lack of Thank you and increase in PoW complexity/or network cost
If the Replier for some reason refuses sending "Thank you secret" broadcaster can deside to increase the Pow complexity for the next interacion / increase the price of the broadcast.

# Discussion
[MORE! All the aspects that can break the protocol.]

# Applications
Sweet Gossip Protocol is an enabler for building P2P apps.
[MORE!]

## Supporting Services
[MORE!]

### Push notification servers
[MORE!]

### Map servers
[MORE!]

### KYC services
[MORE!]

## Uber without Uber
[MORE!]

## Menulog without Menulog
[MORE!]

## Airbnb without Airbnb
[MORE!]

## Upwork without Upwork
[MORE!]

## Mechanical turk without Mechanical turk
[MORE!]

# References
1. WebRTC https://en.wikipedia.org/wiki/WebRTC
2. Bitmessage https://en.wikipedia.org/wiki/Bitmessage